<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>จัดการข่าวทั้งหมด</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f6f9; }
        .table-card { border-radius: 12px; box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.05); }
        .news-title-link:hover { color: var(--primary-color); }
    </style>
</head>
<body>
    <header class="bg-white border-bottom py-3 sticky-top">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-3">
                 <a href="/" class="brand-logo">
                    <img src="/favicon.ico" alt="Hospital Logo" style="width: 32px; height: 32px;">
                    <span class="brand-text">ประชาสัมพันธ์โรงพยาบาลเถิน</span>
                </a>
            </div>
            
            <div class="header-actions d-flex gap-2">
                <a href="/" class="btn btn-outline-secondary btn-sm d-flex align-items-center gap-2 rounded-pill">
                    <i class="bi bi-house-door-fill"></i> หน้าแรก
                </a>
                
                <a href="/admin/upload" class="btn btn-primary btn-sm d-flex align-items-center gap-2 rounded-pill shadow-sm">
                    <i class="bi bi-plus-lg"></i> ลงข่าวใหม่
                </a>
                <a href="/admin/logout" class="btn btn-danger btn-sm d-flex align-items-center gap-2 rounded-pill">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </a>
            </div>
        </div>
    </header>
    
    <main class="container py-5">
        <div class="d-flex justify-content-between align-items-end mb-4">
            <div>
                <h2 class="fw-bold text-dark mb-1">รายการข่าวสาร</h2>
                <p class="text-muted mb-0">ข่าวทั้งหมด <%= newsList.length %> รายการ</p>
            </div>
        </div>

        <% if (message) { %>
            <div class="alert alert-success d-flex align-items-center border-0 shadow-sm mb-4"><i class="bi bi-check-circle-fill me-2 fs-5"></i>
                <div><%= message %></div>
            </div>
        <% } %>
        
        <div class="card table-card">
            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="bg-light">
                        <tr>
                            <th class="py-3 ps-4">ID</th>
                            <th>สถานะ</th>
                            <th>หัวข้อข่าว</th>
                            <th>ช่วงเวลา</th>
                            <th class="text-center">ยอดวิว</th>
                            <th class="text-end pe-4">จัดการ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% newsList.forEach(news => { %>
                            <% 
                                const now = moment();
                                const startDate = moment(news.start_date);
                                const endDate = moment(news.end_date);
                                let badgeClass = '', iconClass = '', statusText = '';
                                if (now.isBetween(startDate, endDate, undefined, '[]')) {
                                    badgeClass = 'bg-success bg-opacity-10 text-success'; iconClass = 'bi-broadcast'; statusText = 'ออนไลน์';
                                } else if (now.isBefore(startDate)) {
                                    badgeClass = 'bg-warning bg-opacity-10 text-warning'; iconClass = 'bi-clock'; statusText = 'รอเผยแพร่';
                                } else {
                                    badgeClass = 'bg-danger bg-opacity-10 text-danger'; iconClass = 'bi-slash-circle'; statusText = 'หมดอายุ';
                                }
                            %>
                            <tr>
                                <td class="ps-4 fw-bold text-muted">#<%= news.id %></td>
                                <td><span class="badge <%= badgeClass %> rounded-pill px-3 py-2"><i class="bi <%= iconClass %> me-1"></i><%= statusText %></span></td>
                                <td>
                                    <span class="badge bg-light text-dark border mb-1"><%= news.category %></span>
                                    <div class="fw-bold text-dark text-truncate" style="max-width: 300px;"><%= news.title %></div>
                                </td>
                                <td class="small text-muted">
                                    <div class="d-flex align-items-center mb-1"><i class="bi bi-play-circle me-2 text-success"></i><%= moment(news.start_date).format('D MMM YY HH:mm') %></div>
                                    <div class="d-flex align-items-center"><i class="bi bi-stop-circle me-2 text-danger"></i><%= moment(news.end_date).format('D MMM YY HH:mm') %></div>
                                </td>
                                <td class="text-center fw-bold text-secondary"><%= news.view_count %></td>
                                <td class="text-end pe-4">
                                    <a href="/admin/edit/<%= news.id %>" class="btn btn-light text-primary btn-sm rounded-circle shadow-sm me-1" title="แก้ไข"><i class="bi bi-pencil-fill"></i></a>
                                    <a href="/admin/delete/<%= news.id %>" class="btn btn-light text-danger btn-sm rounded-circle shadow-sm" onclick="return confirm('ยืนยันการลบ?');" title="ลบ"><i class="bi bi-trash-fill"></i></a>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>